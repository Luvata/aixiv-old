---
title: 2304.02234v2 JPEG Compressed Images Can Bypass Protections Against AI Editing
date: 2023-04-03
---

# [JPEG Compressed Images Can Bypass Protections Against AI Editing](http://arxiv.org/abs/2304.02234v2)

authors: Pedro Sandoval-Segura, Jonas Geiping, Tom Goldstein


## What, Why and How

[1]: https://arxiv.org/pdf/2304.02234v2 "A arXiv:2304.02234v2 [cs.LG] 7 Apr 2023"
[2]: https://arxiv.org/abs/2304.02234 "JPEG Compressed Images Can Bypass Protections Against AI Editing"
[3]: http://export.arxiv.org/abs/2207.02234v2 "[2207.02234v2] Standard Model estimate of $K^+\\to\\pi^+4e$ branching ratio"

Here is a summary of the paper at [^1^][1] in terms of What, Why, and How:

- **What**: The paper is about JPEG Compressed Images Can Bypass Protections Against AI Editing. It shows that imperceptible perturbations that are supposed to protect images from being edited by text-to-image diffusion models are not robust to JPEG compression, which is a common image format.
- **Why**: The paper is motivated by the concern that text-to-image diffusion models can be used for malicious editing or deepfake creation, which can have negative impacts on privacy, security, and trust. The paper aims to demonstrate the weakness of existing protection methods and encourage alternative approaches to protect images against editing.
- **How**: The paper uses the open-source notebooks from the photoguard repository (Salman et al., 2023), which employs the Stable Diffusion Model (SDM) v1.5 (Rombach et al., 2022). The paper applies JPEG compression to protected images and shows that the SDM can still generate realistic edits or new images from text prompts. The paper also discusses the importance of robustness for additive imperceptible perturbations and suggests some possible directions for future work.


## Main Contributions

[1]: https://arxiv.org/pdf/2304.02234v2 "A arXiv:2304.02234v2 [cs.LG] 7 Apr 2023"
[2]: https://arxiv.org/abs/2304.02234 "JPEG Compressed Images Can Bypass Protections Against AI Editing"
[3]: http://export.arxiv.org/abs/2207.02234v2 "[2207.02234v2] Standard Model estimate of $K^+\\to\\pi^+4e$ branching ratio"

According to the paper at [^1^][1], the main contributions are:

- The paper is the first to show that JPEG compression can bypass the protection methods proposed by Salman et al. (2023) and Shan et al. (2023), which use imperceptible perturbations to prevent text-to-image diffusion models from generating realistic images.
- The paper provides empirical evidence that the optimized perturbations are not robust to JPEG compression, which is a common image format and transformation. The paper shows that applying JPEG compression to protected images can enable the Stable Diffusion Model (SDM) v1.5 (Rombach et al., 2022) to generate realistic edits or new images from text prompts.
- The paper discusses the importance of robustness for additive imperceptible perturbations and suggests some possible directions for future work, such as using adversarial training, watermarking, or digital signatures to protect images against editing.


## Method Summary

[1]: https://arxiv.org/pdf/2304.02234v2 "A arXiv:2304.02234v2 [cs.LG] 7 Apr 2023"
[2]: https://arxiv.org/abs/2304.02234 "JPEG Compressed Images Can Bypass Protections Against AI Editing"
[3]: http://export.arxiv.org/abs/2207.02234v2 "[2207.02234v2] Standard Model estimate of $K^+\\to\\pi^+4e$ branching ratio"

The method section of the paper at [^1^][1] describes the following steps:

- The paper uses the open-source notebooks from the photoguard repository (Salman et al., 2023), which employs the Stable Diffusion Model (SDM) v1.5 (Rombach et al., 2022) as the text-to-image diffusion model. The paper also uses the same images and text prompts as Salman et al. (2023) for consistency and reproducibility.
- The paper applies JPEG compression to the protected images generated by Salman et al. (2023) and Shan et al. (2023), which use imperceptible perturbations to prevent the SDM from generating realistic images. The paper uses different levels of JPEG quality factors (QF) ranging from 5 to 100 to test the robustness of the perturbations.
- The paper evaluates the effectiveness of JPEG compression in bypassing the protection methods by visually inspecting the edited or new images generated by the SDM from text prompts. The paper also uses two quantitative metrics: peak signal-to-noise ratio (PSNR) and structural similarity index measure (SSIM) to measure the similarity between the original and edited images.


## Pseudo Code - High level

Here is a possible high-level pseudo code for the paper at :

```
# Input: a set of images and text prompts
# Output: a set of edited or new images generated by the SDM

# Load the photoguard repository and the SDM
photoguard = load_photoguard()
sdm = load_sdm()

# For each image and text prompt pair
for image, text in zip(images, texts):
  # Apply the protection methods by Salman et al. (2023) and Shan et al. (2023)
  protected_image_salman = photoguard.protect_salman(image)
  protected_image_shan = photoguard.protect_shan(image)

  # For each JPEG quality factor (QF)
  for qf in range(5, 100, 5):
    # Apply JPEG compression to the protected images
    compressed_image_salman = jpeg_compress(protected_image_salman, qf)
    compressed_image_shan = jpeg_compress(protected_image_shan, qf)

    # Generate edited or new images from the text prompt using the SDM
    edited_image_salman = sdm.generate(compressed_image_salman, text)
    edited_image_shan = sdm.generate(compressed_image_shan, text)

    # Evaluate the similarity between the original and edited images using PSNR and SSIM
    psnr_salman = psnr(image, edited_image_salman)
    psnr_shan = psnr(image, edited_image_shan)
    ssim_salman = ssim(image, edited_image_salman)
    ssim_shan = ssim(image, edited_image_shan)

    # Display the original, protected, compressed, and edited images and their metrics
    display(image, protected_image_salman, compressed_image_salman, edited_image_salman,
            protected_image_shan, compressed_image_shan, edited_image_shan,
            psnr_salman, psnr_shan, ssim_salman, ssim_shan)
```


## Pseudo Code - Detail

Here is a possible detailed pseudo code to implement the paper at :

```
# Import the necessary libraries
import numpy as np
import cv2
import torch
import torchvision
import photoguard # the photoguard repository
import sdm # the Stable Diffusion Model

# Define the JPEG quality factors (QF) to test
qf_list = np.arange(5, 100, 5)

# Define the PSNR and SSIM functions
def psnr(img1, img2):
  # Compute the mean squared error between two images
  mse = np.mean((img1 - img2) ** 2)
  # Compute the peak signal-to-noise ratio in decibels
  psnr = 10 * np.log10(255 ** 2 / mse)
  return psnr

def ssim(img1, img2):
  # Convert the images to grayscale
  img1 = cv2.cvtColor(img1, cv2.COLOR_BGR2GRAY)
  img2 = cv2.cvtColor(img2, cv2.COLOR_BGR2GRAY)
  # Compute the structural similarity index measure
  ssim = skimage.metrics.structural_similarity(img1, img2)
  return ssim

# Load the images and text prompts from a data folder
images = []
texts = []
for filename in os.listdir(data_folder):
  if filename.endswith(".jpg"):
    # Read the image as a numpy array
    image = cv2.imread(os.path.join(data_folder, filename))
    # Append the image to the list
    images.append(image)
  elif filename.endswith(".txt"):
    # Read the text prompt as a string
    text = open(os.path.join(data_folder, filename)).read()
    # Append the text to the list
    texts.append(text)

# Load the photoguard protection methods and the SDM model
protect_salman = photoguard.protect_salman()
protect_shan = photoguard.protect_shan()
sdm_model = sdm.load_model()

# For each image and text prompt pair
for image, text in zip(images, texts):
  # Convert the image to a torch tensor
  image_tensor = torchvision.transforms.ToTensor()(image)

  # Apply the protection methods by Salman et al. (2023) and Shan et al. (2023)
  protected_image_salman_tensor = protect_salman(image_tensor)
  protected_image_shan_tensor = protect_shan(image_tensor)

  # Convert the protected images back to numpy arrays
  protected_image_salman = torchvision.transforms.ToPILImage()(protected_image_salman_tensor).convert("RGB")
  protected_image_shan = torchvision.transforms.ToPILImage()(protected_image_shan_tensor).convert("RGB")

  # For each JPEG quality factor (QF)
  for qf in qf_list:
    # Apply JPEG compression to the protected images using OpenCV
    _, encoded_image_salman = cv2.imencode(".jpg", protected_image_salman, [int(cv2.IMWRITE_JPEG_QUALITY), qf])
    _, encoded_image_shan = cv2.imencode(".jpg", protected_image_shan, [int(cv2.IMWRITE_JPEG_QUALITY), qf])
    compressed_image_salman = cv2.imdecode(encoded_image_salman, cv2.IMREAD_COLOR)
    compressed_image_shan = cv2.imdecode(encoded_image_shan, cv2.IMREAD_COLOR)

    # Convert the compressed images to torch tensors
    compressed_image_salman_tensor = torchvision.transforms.ToTensor()(compressed_image_salman)
    compressed_image_shan_tensor = torchvision.transforms.ToTensor()(compressed_image_shan)

    # Generate edited or new images from the text prompt using the SDM model
    edited_image_salman_tensor = sdm_model.generate(compressed_image_salman_tensor, text)
    edited_image_shan_tensor = sdm_model.generate(compressed_image_shan_tensor, text)

    # Convert the edited images back to numpy arrays
    edited_image_salman = torchvision.transforms.ToPILImage()(edited_image_salman_tensor).convert("RGB")
    edited_image_shan = torchvision.transforms.ToPILImage()(edited_image_shan_tensor).convert("RGB")

    # Evaluate the similarity between the original and edited images using PSNR and SSIM
    psnr_salman = psnr(image, edited_image_salman)
    psnr_shan = psnr(image, edited_image_shan)
    ssim_salman = ssim(image, edited_image_salman)
    ssim_shan = ssim(image, edited_image_shan)

    # Display the original, protected, compressed, and edited images and their metrics using matplotlib
    plt.figure(figsize=(15,10))
    plt.subplot(2,4,1)
    plt.imshow(image)
    plt.title("Original image")
    plt.subplot(2,4,2)
    plt.imshow(protected_image_salman)
    plt.title("Protected image by Salman et al. (2023)")
    plt.subplot(2,4,3)
    plt.imshow(compressed_image_salman)
    plt.title(f"Compressed image by JPEG (QF={qf})")
    plt.subplot(2,4,4)
    plt.imshow(edited_image_salman)
    plt.title(f"Edited image by SDM (PSNR={psnr_salman:.2f}, SSIM={ssim_salman:.2f})")
    plt.subplot(2,4,5)
    plt.imshow(image)
    plt.title("Original image")
    plt.subplot(2,4,6)
    plt.imshow(protected_image_shan)
    plt.title("Protected image by Shan et al. (2023)")
    plt.subplot(2,4,7)
    plt.imshow(compressed_image_shan)
    plt.title(f"Compressed image by JPEG (QF={qf})")
    plt.subplot(2,4,8)
    plt.imshow(edited_image_shan)
    plt.title(f"Edited image by SDM (PSNR={psnr_shan:.2f}, SSIM={ssim_shan:.2f})")
    plt.show()
```